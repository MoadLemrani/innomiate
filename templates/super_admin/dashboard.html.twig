{% extends 'base.html.twig' %}

{% block title %}Bienvenue Super Admin
{% endblock %}

{% block body %}
	<div class="dashboard-container">
		<h1 class="dashboard-title">Bonjour,
			{{ currentUser.firstName ?? 'Super Administrateur' }}
			ðŸ‘‹</h1>
		<p class="dashboard-subtitle">Bienvenue sur votre tableau de bord.</p>

		{# Statistics Section #}
		<div class="stat-card">
			<h3>Total Users</h3>
			<p class="stat-value">{{ userStats.total }}</p>
		</div>
		<div class="stat-card">
			<h3>Verified Users</h3>
			<p class="stat-value">{{ userStats.verified }}</p>
		</div>
		<div class="stat-card">
			<h3>Unverified Users</h3>
			<p class="stat-value">{{ userStats.unverified }}</p>
		</div>
		<div class="stat-card">
			<h3>Verification Rate</h3>
			<p class="stat-value">{{ (userStats.verification_rate)|number_format(1) }}%</p>
		</div>

		{# Unverified Users Section #}
		{% if unverifiedUsers|length > 0 %}
			<div class="section">
				<h2>Users Awaiting Verification</h2>
				<div class="unverified-users">
					{% for user in unverifiedUsers %}
						<div class="user-card">
							<p>{{ user.email }}</p>
							<div class="actions">
								<button class="verify-btn">Verify</button>
								<button class="reject-btn">Reject</button>
							</div>
						</div>
					{% endfor %}
				</div>
			</div>
		{% endif %}

		{# All Users Table #}
		<div class="section">
			<h2>User Management</h2>
			<table class="styled-table">
				<thead>
					<tr>
						<th>Email</th>
						<th>First Name</th>
						<th>Last Name</th>
						<th>RÃ´les</th>
						<th>Status</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
						<tr>
							<td>{{ user.email }}</td>
							<td>{{ user.firstName ?? 'N/A' }}</td>
							<td>{{ user.lastName ?? 'N/A' }}</td>
							<td>
								{% for role in user.roles %}
									{% if role != 'ROLE_USER' %}
										<span class="badge {{ role == 'ROLE_ADMIN' ? 'admin-badge' : 'participant-badge' }}">
											{{ role|replace({'ROLE_': ''})|lower|capitalize }}
										</span>
									{% endif %}
								{% endfor %}
							</td>
							<td>
								<span class="status-badge {{ user.isVerified ? 'verified' : 'unverified' }}">
									{{ user.isVerified ? 'Verified' : 'Unverified' }}
								</span>
							</td>
							<td class="actions">
								<a href="#" class="action-link edit">Modifier</a>
								|
								<a href="#" class="action-link delete">Supprimer</a>
								{% if not user.isVerified %}
									|
									<a href="#" class="action-link verify">Verify</a>
								{% endif %}
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<a href="{{ path('app_logout') }}" class="logout-link">ðŸšª DÃ©connexion</a>

		<button id="darkModeToggle" class="theme-toggle" aria-label="Toggle theme">
			<span class="sun-icon">
				<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="currentColor" class="size-6">
					<path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591ZM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59ZM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12ZM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591Z"/>
				</svg>
			</span>
			<span class="moon-icon">
				<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="currentColor" class="size-6">
					<path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"/>
				</svg>
			</span>
		</button>

		<script>
			// Same JavaScript as before
const themeToggle = document.getElementById('darkModeToggle');
const sunIcon = themeToggle.querySelector('.sun-icon');
const moonIcon = themeToggle.querySelector('.moon-icon');

function initializeTheme() {
const savedTheme = localStorage.getItem('theme');
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
const defaultTheme = savedTheme || (prefersDark ? 'dark' : 'light');
document.documentElement.setAttribute('data-theme', defaultTheme);
updateToggleIcons(defaultTheme === 'dark');
if (! savedTheme) {
localStorage.setItem('theme', defaultTheme);
}
}

function updateToggleIcons(isDark) {
sunIcon.style.display = isDark ? 'inline-block' : 'none';
moonIcon.style.display = isDark ? 'none' : 'inline-block';
}

function toggleTheme() {
const currentTheme = document.documentElement.getAttribute('data-theme');
const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
document.documentElement.setAttribute('data-theme', newTheme);
localStorage.setItem('theme', newTheme);
updateToggleIcons(newTheme === 'dark');
}

initializeTheme();

themeToggle.addEventListener('click', toggleTheme);
themeToggle.addEventListener('keydown', function (e) {
if (e.key === ' ' || e.key === 'Enter') {
e.preventDefault();
toggleTheme();
}
});
		</script>

		<style>:root
		{
			--bg: #0f1621;
			--text: #f0f0f0;
			--secondary: #b0b0b0;
			--accent: #2ecc71;
			--danger: #ff3e5f;
			--warning: #f39c12;
			--info: #3498db;
			--card: rgba(255, 255, 255, 0.05);
			--border: rgba(255, 255, 255, 0.1);
		}
		:root[data-theme='light'] {
			--bg: #f8f9fa;
			--text: #2c3e50;
			--secondary: #6c757d;
			--accent: #27ae60;
			--danger: #e74c3c;
			--warning: #e67e22;
			--info: #2980b9;
			--card: #ffffff;
			--border: #dee2e6;
		}

		body {
			background: var(--bg);
			color: var(--text);
			margin: 0;
			font-family: 'Segoe UI', sans-serif;
		}

		.dashboard-container {
			padding: 2rem;
			max-width: 1200px;
			margin: auto;
		}

		.dashboard-title {
			font-size: 2rem;
			margin-bottom: 0.5rem;
		}

		.dashboard-subtitle {
			color: var(--secondary);
			margin-bottom: 2rem;
		}

		.section {
			margin-bottom: 2rem;
		}

		.section h2 {
			border-bottom: 2px solid var(--accent);
			padding-bottom: 0.5rem;
			margin-bottom: 1rem;
		}

		.stats-container {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 1rem;
			margin-bottom: 2rem;
		}

		.stat-card {
			background: var(--card);
			border-radius: 8px;
			padding: 1.5rem;
			text-align: center;
			border: 1px solid var(--border);
		}

		.stat-card h3 {
			margin-top: 0;
			color: var(--secondary);
			font-size: 1rem;
		}

		.stat-value {
			font-size: 2rem;
			font-weight: bold;
			margin: 0.5rem 0 0;
			color: var(--accent);
		}

		.styled-table {
			width: 100%;
			border-collapse: collapse;
			background-color: var(--card);
			border: 1px solid var(--border);
			border-radius: 6px;
			overflow: hidden;
		}

		.styled-table th,
		.styled-table td {
			padding: 12px 16px;
			text-align: left;
			border-bottom: 1px solid var(--border);
		}

		.styled-table thead {
			background-color: var(--accent);
			color: white;
		}

		.styled-table tbody tr:hover {
			background-color: rgba(255, 255, 255, 0.05);
		}

		.badge {
			display: inline-block;
			padding: 3px 8px;
			border-radius: 12px;
			font-size: 0.75rem;
			margin-right: 5px;
			color: white;
		}

		.admin-badge {
			background-color: var(--danger);
		}

		.participant-badge {
			background-color: var(--info);
		}

		.status-badge {
			display: inline-block;
			padding: 3px 8px;
			border-radius: 12px;
			font-size: 0.75rem;
			color: white;
		}

		.status-badge.verified {
			background-color: var(--accent);
		}

		.status-badge.unverified {
			background-color: var(--warning);
		}

		.action-link {
			text-decoration: none;
			font-weight: 500;
			padding: 2px 5px;
			border-radius: 4px;
		}

		.action-link.edit {
			color: var(--info);
		}

		.action-link.delete {
			color: var(--danger);
		}

		.action-link.verify {
			color: var(--accent);
		}

		.actions {
			white-space: nowrap;
		}

		.unverified-users {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
			gap: 1rem;
			margin-bottom: 2rem;
		}

		.user-card {
			background: var(--card);
			border: 1px solid var(--border);
			border-radius: 8px;
			padding: 1rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.user-card p {
			margin: 0;
		}

		.verify-btn,
		.reject-btn {
			border: none;
			padding: 5px 10px;
			border-radius: 4px;
			cursor: pointer;
			font-weight: 500;
		}

		.verify-btn {
			background-color: var(--accent);
			color: white;
			margin-right: 5px;
		}

		.reject-btn {
			background-color: var(--danger);
			color: white;
		}

		.logout-link {
			display: inline-block;
			margin-top: 2rem;
			text-decoration: none;
			color: var(--danger);
			font-weight: bold;
		}

		.theme-toggle {
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 999;
			background: var(--card);
			border: 2px solid var(--border);
			border-radius: 50px;
			padding: 10px;
			cursor: pointer;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.theme-toggle:hover {
			transform: scale(1.05);
			box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
		}

		.theme-toggle .sun-icon,
		.theme-toggle .moon-icon {
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.theme-toggle svg {
			width: 24px;
			height: 24px;
			display: block;
			color: currentColor;
			transition: all 0.3s ease;
		}

		.theme-toggle .sun-icon svg {
			color: #ffa500;
		}

		.theme-toggle .moon-icon svg {
			color: #4cc9f0;
			}/* Light theme toggle adjustments */:root[data-theme="light"] .theme-toggle
			{
				border-color: var(--secondary);
			}
	</style>
{% endblock %}
